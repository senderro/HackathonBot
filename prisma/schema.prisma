// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         BigInt   @id
  username   String?
  first_name String?
  last_name  String?
  created_at DateTime @default(now())
  aliases    UserAlias[]
  BagsAdmin  Bag[]    @relation("AdminOf")
  bags       BagUser[]
}

model UserAlias {
  id      Int    @id @default(autoincrement())
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId  BigInt
  alias   String
}

model Bag {
  id                 Int       @id @default(autoincrement())
  chat_id            BigInt    @unique
  name               String
  admin              User      @relation("AdminOf", fields: [adminUserId], references: [id])
  adminUserId        BigInt
  created_at         DateTime  @default(now())
  welcome_message_id BigInt?
  participants       BagUser[]
}

model BagUser {
  bag      Bag     @relation(fields: [bagId], references: [id], onDelete: Cascade)
  bagId    Int
  user     User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId   BigInt
  joinedAt DateTime @default(now())

  @@id([bagId, userId])
}
